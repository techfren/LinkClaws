{"version":3,"sources":["../src/toolkit.ts","../src/schemas.ts","../src/functions.ts","../src/tools.ts"],"sourcesContent":["import { AgentMailClient } from 'agentmail'\n\nimport { type Tool, tools } from './tools.js'\n\nexport abstract class BaseToolkit<T> {\n    protected readonly client: AgentMailClient\n    protected readonly tools: Record<string, T> = {}\n\n    constructor(client?: AgentMailClient) {\n        this.client = client ?? new AgentMailClient()\n\n        this.tools = tools.reduce(\n            (acc, tool) => {\n                acc[tool.name] = this.buildTool(tool)\n                return acc\n            },\n            {} as Record<string, T>\n        )\n    }\n\n    protected abstract buildTool(tool: Tool): T\n}\n\nexport abstract class ListToolkit<T> extends BaseToolkit<T> {\n    public getTools(names?: string[]) {\n        if (!names) return Object.values(this.tools)\n\n        return names.reduce((acc, name) => {\n            if (name in this.tools) acc.push(this.tools[name])\n            return acc\n        }, [] as T[])\n    }\n}\n\nexport abstract class MapToolkit<T> extends BaseToolkit<T> {\n    public getTools(names?: string[]) {\n        if (!names) return this.tools\n\n        return names.reduce(\n            (acc, name) => {\n                if (name in this.tools) acc[name] = this.tools[name]\n                return acc\n            },\n            {} as Record<string, T>\n        )\n    }\n}\n","import { z } from 'zod'\n\nconst InboxIdSchema = z.string().describe('ID of inbox')\nconst ThreadIdSchema = z.string().describe('ID of thread')\nconst MessageIdSchema = z.string().describe('ID of message')\nconst AttachmentIdSchema = z.string().describe('ID of attachment')\n\nexport const ListItemsParams = z.object({\n    limit: z.number().optional().default(10).describe('Max number of items to return'),\n    pageToken: z.string().optional().describe('Page token for pagination'),\n})\n\nexport const GetInboxParams = z.object({\n    inboxId: InboxIdSchema,\n})\n\nexport const CreateInboxParams = z.object({\n    username: z.string().optional().describe('Username'),\n    domain: z.string().optional().describe('Domain'),\n    displayName: z.string().optional().describe('Display name'),\n})\n\nexport const ListInboxItemsParams = ListItemsParams.extend({\n    inboxId: InboxIdSchema,\n    labels: z.array(z.string()).optional().describe('Labels to filter items by'),\n    before: z.string().pipe(z.coerce.date()).optional().describe('Filter items before datetime'),\n    after: z.string().pipe(z.coerce.date()).optional().describe('Filter items after datetime'),\n})\n\nexport const GetThreadParams = z.object({\n    inboxId: InboxIdSchema,\n    threadId: ThreadIdSchema,\n})\n\nexport const GetAttachmentParams = z.object({\n    inboxId: InboxIdSchema,\n    threadId: ThreadIdSchema,\n    attachmentId: AttachmentIdSchema,\n})\n\nconst BaseMessageParams = z.object({\n    inboxId: InboxIdSchema,\n    text: z.string().optional().describe('Plain text body'),\n    html: z.string().optional().describe('HTML body'),\n    labels: z.array(z.string()).optional().describe('Labels'),\n})\n\nexport const SendMessageParams = BaseMessageParams.extend({\n    to: z.array(z.string()).describe('Recipients'),\n    cc: z.array(z.string()).optional().describe('CC recipients'),\n    bcc: z.array(z.string()).optional().describe('BCC recipients'),\n    subject: z.string().optional().describe('Subject'),\n})\n\nexport const ReplyToMessageParams = BaseMessageParams.extend({\n    messageId: MessageIdSchema,\n    replyAll: z.boolean().optional().describe('Reply to all recipients'),\n})\n\nexport const UpdateMessageParams = z.object({\n    inboxId: InboxIdSchema,\n    messageId: MessageIdSchema,\n    addLabels: z.array(z.string()).optional().describe('Labels to add'),\n    removeLabels: z.array(z.string()).optional().describe('Labels to remove'),\n})\n","import { AgentMailClient } from 'agentmail'\nimport { extractText, getDocumentProxy } from 'unpdf'\nimport { fileTypeFromBuffer } from 'file-type'\nimport mammoth from 'mammoth'\n\nexport type Args = Record<string, any>\n\ninterface Attachment {\n    text?: string\n    error?: string\n    fileType?: string\n}\n\nexport async function listInboxes(client: AgentMailClient, args: Args) {\n    return client.inboxes.list(args)\n}\n\nexport async function getInbox(client: AgentMailClient, args: Args) {\n    const { inboxId, ...options } = args\n    return client.inboxes.get(inboxId, options)\n}\n\nexport async function createInbox(client: AgentMailClient, args: Args) {\n    return client.inboxes.create(args)\n}\n\nexport async function deleteInbox(client: AgentMailClient, args: Args) {\n    const { inboxId } = args\n    return client.inboxes.delete(inboxId)\n}\n\nexport async function listThreads(client: AgentMailClient, args: Args) {\n    const { inboxId, ...options } = args\n    return client.inboxes.threads.list(inboxId, options)\n}\n\nexport async function getThread(client: AgentMailClient, args: Args) {\n    const { inboxId, threadId, ...options } = args\n    return client.inboxes.threads.get(inboxId, threadId, options)\n}\n\nexport async function getAttachment(client: AgentMailClient, args: Args): Promise<Attachment> {\n    const { threadId, attachmentId } = args\n\n    const response = await client.threads.getAttachment(threadId, attachmentId)\n    const fileBytes = new Uint8Array(await response.arrayBuffer())\n\n    const fileKind = await fileTypeFromBuffer(fileBytes)\n    const fileType = fileKind?.mime\n\n    let text = undefined\n\n    if (fileType === 'application/pdf') {\n        const pdf = await getDocumentProxy(fileBytes)\n        const { text: pdfText } = await extractText(pdf)\n        text = Array.isArray(pdfText) ? pdfText.join('\\n') : pdfText\n    } else if (fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {\n        const result = await mammoth.extractRawText({ arrayBuffer: fileBytes.buffer })\n        text = result.value\n    } else {\n        return { error: `Unsupported file type: ${fileType || 'unknown'}`, fileType }\n    }\n\n    return { text, fileType }\n}\n\nexport async function sendMessage(client: AgentMailClient, args: Args) {\n    const { inboxId, ...options } = args\n    return client.inboxes.messages.send(inboxId, options)\n}\n\nexport async function replyToMessage(client: AgentMailClient, args: Args) {\n    const { inboxId, messageId, ...options } = args\n    return client.inboxes.messages.reply(inboxId, messageId, options)\n}\n\nexport async function updateMessage(client: AgentMailClient, args: Args) {\n    const { inboxId, messageId, ...options } = args\n    return client.inboxes.messages.update(inboxId, messageId, options)\n}\n","import { z } from 'zod'\nimport { AgentMailClient } from 'agentmail'\nimport { type ToolAnnotations } from '@modelcontextprotocol/sdk/types.js'\n\nimport {\n    ListItemsParams,\n    ListInboxItemsParams,\n    GetInboxParams,\n    CreateInboxParams,\n    GetThreadParams,\n    GetAttachmentParams,\n    SendMessageParams,\n    ReplyToMessageParams,\n    UpdateMessageParams,\n} from './schemas.js'\nimport {\n    type Args,\n    listInboxes,\n    getInbox,\n    createInbox,\n    deleteInbox,\n    listThreads,\n    getThread,\n    getAttachment,\n    sendMessage,\n    replyToMessage,\n    updateMessage,\n} from './functions.js'\nexport interface Tool {\n    name: string\n    description: string\n    paramsSchema: z.ZodObject<any>\n    func: (client: AgentMailClient, args: Args) => Promise<any>\n    annotations?: ToolAnnotations\n}\n\nexport const tools: Tool[] = [\n    {\n        name: 'list_inboxes',\n        description: 'List inboxes',\n        paramsSchema: ListItemsParams,\n        func: listInboxes,\n        annotations: {\n            readOnlyHint: true,\n            openWorldHint: false,\n        },\n    },\n    {\n        name: 'get_inbox',\n        description: 'Get inbox',\n        paramsSchema: GetInboxParams,\n        func: getInbox,\n        annotations: {\n            readOnlyHint: true,\n            openWorldHint: false,\n        },\n    },\n    {\n        name: 'create_inbox',\n        description: 'Create inbox',\n        paramsSchema: CreateInboxParams,\n        func: createInbox,\n        annotations: {\n            readOnlyHint: false,\n            destructiveHint: false,\n            idempotentHint: false,\n            openWorldHint: false,\n        },\n    },\n    {\n        name: 'delete_inbox',\n        description: 'Delete inbox',\n        paramsSchema: GetInboxParams,\n        func: deleteInbox,\n        annotations: {\n            readOnlyHint: false,\n            destructiveHint: true,\n            idempotentHint: true,\n            openWorldHint: false,\n        },\n    },\n    {\n        name: 'list_threads',\n        description: 'List threads in inbox',\n        paramsSchema: ListInboxItemsParams,\n        func: listThreads,\n        annotations: {\n            readOnlyHint: true,\n            openWorldHint: true,\n        },\n    },\n    {\n        name: 'get_thread',\n        description: 'Get thread',\n        paramsSchema: GetThreadParams,\n        func: getThread,\n        annotations: {\n            readOnlyHint: true,\n            openWorldHint: true,\n        },\n    },\n    {\n        name: 'get_attachment',\n        description: 'Get attachment',\n        paramsSchema: GetAttachmentParams,\n        func: getAttachment,\n        annotations: {\n            readOnlyHint: true,\n            openWorldHint: true,\n        },\n    },\n    {\n        name: 'send_message',\n        description: 'Send message',\n        paramsSchema: SendMessageParams,\n        func: sendMessage,\n        annotations: {\n            readOnlyHint: false,\n            destructiveHint: false,\n            idempotentHint: false,\n            openWorldHint: true,\n        },\n    },\n    {\n        name: 'reply_to_message',\n        description: 'Reply to message',\n        paramsSchema: ReplyToMessageParams,\n        func: replyToMessage,\n        annotations: {\n            readOnlyHint: false,\n            destructiveHint: false,\n            idempotentHint: false,\n            openWorldHint: true,\n        },\n    },\n    {\n        name: 'update_message',\n        description: 'Update message',\n        paramsSchema: UpdateMessageParams,\n        func: updateMessage,\n        annotations: {\n            readOnlyHint: false,\n            destructiveHint: false,\n            idempotentHint: true,\n            openWorldHint: false,\n        },\n    },\n]\n"],"mappings":"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","names":[]}