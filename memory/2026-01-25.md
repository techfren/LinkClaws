# 2026-01-25

## Alexa Shopping List API - BREAKTHROUGH! ðŸŽ‰

**Goal:** Access Alexa shopping list programmatically from VPS without tunnel/browser relay

### The Problem
- Amazon deprecated the official List Management API on July 1, 2024
- All official endpoints return 503/404
- Third-party integrations (AnyList, Todoist) lost native access
- alexa-remote2 library requires full browser cookies

### The Solution (Discovered Today!)

**Key insight:** The refresh token from `alexa-cookie-cli` can be exchanged for auth cookies:

```javascript
POST api.amazon.com/auth/token
{
  source_token: refreshToken,
  source_token_type: 'refresh_token',
  requested_token_type: 'auth_cookies',  // <-- THIS IS THE MAGIC
  domain: '.amazon.com'
}
```

This returns full browser cookies valid for ~30 days!

### Working V2 API Endpoints

Base: `https://www.amazon.com/alexashoppinglists/api/v2/`

- `POST /lists/fetch` - Get all lists
- `POST /lists/{id}/items/fetch?limit=100` - Get items
- `POST /lists/{id}/items` - Add item
- `PUT /lists/{id}/items/{itemId}` - Update item
- `DELETE /lists/{id}/items/{itemId}` - Delete item

### Capabilities
âœ… Read shopping list
âœ… Read to-do list
âœ… Add items
âœ… Update items (mark complete, rename)
âœ… Delete items
âœ… Runs entirely on VPS
âœ… No tunnel needed
âœ… No browser relay needed

### Files Created
- `/home/ubuntu/clawd/docs/alexa-shopping-list-api.md` - Full documentation
- `/home/ubuntu/clawd/projects/alexa-remote-test/v2-api.js` - Working implementation
- `/home/ubuntu/clawd/projects/alexa-remote-test/.alexa-tokens.json` - AJ's tokens

### Token Info
- Refresh token from alexa-cookie-cli: `Atnr|EwMDII5ZuBSU2xX4...`
- Cookies TTL: 30 days (2592000 seconds)
- Will need to re-auth when refresh token expires

### Research Method
Used Exa AI deep search to find:
1. Deprecation announcement (The Verge, Home Assistant forums)
2. Working workarounds (TheSethRose/Alexa-Shopping-List, amazon_shopping_list_scrape)
3. V2 API structure from alexa-remote2 source code

### Next Steps
- [x] Test adding items to shopping list âœ… Added "organic bananas"
- [ ] Build full service/API wrapper
- [ ] Add to Amazon cart flow (needs ASIN lookup)
- [x] Set up cron for token health check âœ…

### Cron Job Set Up
```
0 9 * * * cd /home/ubuntu/clawd/projects/alexa-remote-test && node health-check.js >> logs/alexa-health.log
```
- Runs daily at 9 AM UTC
- Checks if tokens still work
- Saves status to `.alexa-status.json`
- Logs to `/home/ubuntu/clawd/logs/alexa-health.log`

---

## Context Restoration Note

Context compacted earlier due to long conversation from yesterday (WhatsApp/Discord setup, browser relay banana test). Memory preserved in 2026-01-24.md.
